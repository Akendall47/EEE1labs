# Lab Skills
## Part 1
## Section 2 - Pulses

In this section you will use the oscilloscope to measure electrical pulses, and use those pulses to control a servo motor. The multimeter is useful for measuring static values like resistance or the voltage of a power supply but often we are more interested in how a quantity varies over time.
Voltages and other electrical quantities can change very quickly in electronic circuits and the oscilloscope is an instrument designed to display graphs of rapidly-changing signals.

A servo motor is a motor used to control the position of a mechanism.
The types included in your kit can't rotate continuously, but they can turn to a specific angle when commanded by a control signal.
In this section you'll use the Orangepip to generate the control signal and use the oscilloscope to find out how it works.
You'll need these items for this section:

| Description | Quantity | 
| -------- | ----------- |
| **Modules and assemblies** |
| EEEBug Chassis Assembly | 1 |
| **Equipment** |
| Oscilloscope | 1 |
| **Electronic components** |
| 3 way 2.54mm header | 2 |
| 10kΩ rotary potentiometer | 2 |
| **Wires and cables** |
| USB Cable | 1 |
| **Software** |
| Arduino IDE |
| Fritzing |
| **Downloads** |
| `servo.fz` Fritzing project |
| `twoservo.fz` Fritzing project |
| `servo.ino` Arduino Sketch |

### Before the lab
Install (Arduino IDE)[https://www.arduino.cc/en/software] on your computer.
(Watch this video about using the PicoScope oscilloscope)[https://imperial.cloud.panopto.eu/Panopto/Pages/Viewer.aspx?id=08772fd6-0eab-4e4a-a5b3-ac5600dde606]
	
### Test the servo motors
	
Connect a servo motor to the breadboard and the Orangepip as shown in the Fritzing project `servopot`.
The servo cable connects via a 3-pin header, which may already be inserted into the connector at the end of the servo motor cable.
Be certain that you have connected the servo motor wires correctly according to colour — it is possible to damage the servo motor if it is connected incorrectly.
A potentiometer is also included and, like before, it is used as a potential divider to generate a variable voltage.
The output from the potential divider is connected to the Orangepip, which converts the voltage into a control signal for the servo motor.
		
Connect the Orangepip to your computer with the USB cable.
Run Arduino IDE, open the `servo.ino` file and connect to the Orangepip by clicking Tools→Port and selecting the item which says `Arduino Uno'.
Click the upload button, which will start the compilation process and program the Orangepip.
		
	    {\centering
	    \includegraphics[height=5cm]{graphics/servo-photo}
	    
	    \footnotesize\centering
	    \emph{Servo motor connected to Orangepip with potentiometer input}
	    }
		
Now when you power up the circuit you should see some initial movement of the servo motor.
Try turning the potentiometer and you should see the servo motor change position.
	
- [ ]	Wire up a servo motor to the 5V power supply and the control signal generated by the Orangepip. Check that you can rotate the motor using the potentiometer. Suggested logbook entry: video of servo moving (or photos in different positions if an embedded video is not possible).
	
### Oscilloscope
	
The servo motor is controlled by a digital pulse signal.
A digital signal is a voltage that switches between two discrete levels and a pulse means that the waveform is asymmetric — the signal is `on' for less time than it is `off'.
The servo motor signal has pulses at a regular interval of 50 per second (50 Hz) and the *width* (on time) of each pulse is in the range 0.5–1.5ms.
		
		{\centering
		\begin{tikzpicture}
		    \draw[->] (0,0) to node[below] {time} (12,0) ;
		    \draw[->] (0,0) to node[above,rotate=90] {voltage} (0,5) ;
		    \draw (0.5,0.5) coordinate (x);
		    \foreach \i in {0,..3}
		        \draw (x) -- ++(1,0) -- ++(0,4) -- ++(1.2,0) -- ++(0,-4) -- ++ (2.8,0) coordinate (x);
		    \draw (0,0.5) node [left] {0};
		    \draw (0,4.5) node [left] {5};
		    \draw [blue,->] (1.5,3) -- (2.7,3) node [right] {0.5--1.5ms};
		    \draw [blue,->] (1.5,2) -- (6.5,2) node [right] {20ms};
		\end{tikzpicture}}
	
The oscilloscope normally shows a graph of voltage on the y axis and time on the x axis.
The x origin of the graph (where time =0) is synchronised to an event called the *trigger*.
Every time a trigger occurs, the graph is updated and if the trigger happens very frequently you will see waveform following any changes to the signal in real time.
		
The oscilloscope measures voltage with a *probe* that is connected to the signal that you wish to measure.
Connect one of the oscilloscope probes to the terminal A on the PicoScope.
The probe connector has a bayonet-type connector that you twist to lock into place. 
Make sure that the slider on the body of the probe is set to '10x'.
		
Disconnect the servo motor control wire from pin 9 of the Orangepip and connect the oscilloscope probe in its place with a short length of wire as shown below.
Since voltage is a relative measurement, not absolute, a ground lead is also attached to a reference point on the circuit — usually the 0V or GND node of the circuit.
Connect the ground lead to the GND pin with a separate piece of wire.
		
	    {\centering
	    \includegraphics[width=10cm]{graphics/orange-probe}
	    
	    \footnotesize\centering
	    \emph{Connection of the oscilloscope probe to an Orangepip pin}
	    }
		
Start the PicoScope 6 software and open the settings file `servo.pssettings`.
You should see a graph showing the pulses of the waveform.
Adjust the potentiometer on your breadboard to see how the signal changes as the servo is commanded to move to different angles.
This system of representing information in the width of a pulse is called *pulse width modulation* (PWM).
Use the axis scales on the oscilloscope screen to read the voltage and period (repetition time) of the signal.
		
It's hard to read the width of the pulses on the display at the moment so we need to zoom in on the horizontal (time) axis.
Do this by clicking the left-hand arrow next to the timebase setting, where it currently displays 10ms/div.
You'll see the pulse grow in width and the x axis labels change as the graph is scaled.
		
	    {\centering
	    \includegraphics[height=1cm]{graphics/pico-timebase}
	    
	    \footnotesize\centering
	    \emph{Timebase (x-axis scale) control in PicoScope software}
	    }
		
You'll see the origin of the horizontal axis remains in the centre of the screen.
This is the trigger point, where the oscilloscope has detected the start of the pulse.
The trigger is represented by a yellow diamond on the screen.
Drag it to the left and decrease the timebase further so that the pulse fills the display.
Now you can make a more accurate measurement of the width of the pulse.
		
		
	    {\centering
	    \includegraphics[height=8cm]{graphics/pico-pulse}
	    
	    \footnotesize\centering
	    \emph{Pulse signal observed with a PicoScope}
	    }
	
- [ ]	Use the oscilloscope to display the servo motor control signal. Make measurements of the period, pulse width and voltage of the signal using the oscilloscope display gridlines. Suggested logbook entry: a screen capture of the oscilloscope showing pulses.
		\end{task}
	
### Cursors
	
Using the gridlines to make precise measurements can be labourious so *cursors* are provided make it easier.
Change the timebase back to 10ms so that multiple pulses are visible on the screen.
Drag the two time-axis cursors onto the graph from their parked position as a small white square in the bottom left hand corner of the plot area.
A box at the top of the plot shows you information about the cursors, including the time axis position of each cursor and the time difference (Δ) between them.
Another box in the bottom right of box shows you the calculation 1/Δ.
		
Move the cursors so they align with the rising edges of two consecutive pulses.
Now you can read the time difference between the pulses (the period of the signal) as the Δ value.
The reciprocal of period is frequency, so the 1/Δ box is now displaying the frequency of the signal in Hertz.
Make a more accurate measurement of the period of the signal, then zoom in again to measure the pulse width with the cursors.
Use your multimeter to measure the potentiometer output voltage and find the relationship between voltage and pulse width.
		

	    {\centering
	    \includegraphics[height=8cm]{graphics/pico-curs}
	    
	    \footnotesize\centering
	    \emph{Measuring pulse width with cursors}
	    }

Cursors can also be used to measure voltage.
The voltage axis cursors are parked at the top of the voltage axis as a blue square.
When you add a second probe and trace (the `B' channel) to the oscilloscope in the next section, you'll find the B channel has a separate voltage axis and its own pair of cursors on the right hand side of the plot.

- [ ]	Use the cursors to make more accurate measurements of the control signal characteristics. Find the relationship between the potentiometer voltage and the pulse width. Suggested logbook entry: a table of voltages and pulse widths.

- [ ] Reconnect the servo motor and find the relationship between the pulse width and approximate motor angle (it's fine to guess if you don't have a protractor or similar to measure angle). Suggested logbook entry: an extra column in the previous table showing approximate motor angle.
		
### Challenge: two servo motors
The Orangepip can generate control signals for two servo motors. Use the circuit in `twoservo.fz` to connect a second servo motor and potentiometer.
